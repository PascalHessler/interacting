summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
set.seed(123)
n=606
ability=rnorm(n,50,10)
test1=round(ability+rnorm(n,0,10),0)
test2=round(ability+rnorm(n,0,10),0)
cor(test1,test2)
set.seed(123)
n=606
ability=rnorm(n,50,10)
test1=round(ability+rnorm(n,0,7),0)
test2=round(ability+rnorm(n,0,7),0)
test1
test2
cor(test1,test2)
set.seed(123)
n=606
ability=rnorm(n,50,10)
test1=round(ability+rnorm(n,0,7),0)
test2=round(ability+rnorm(n,0,7),0)
cor(test1,test2)
df=data.frame(1:n,test1,test2)
n=120
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
summary(lmk)$coefficients[3,4]
df=data.frame(1:n,test1,test2)
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
p[k] = summary(lmk)$coefficients[3,4]
p=c()
df=data.frame(1:n,test1,test2)
set.seed(123)
n=606
ability=rnorm(n,50,10)
test1=round(ability+rnorm(n,0,7),0)
test2=round(ability+rnorm(n,0,7),0)
cor(test1,test2)
df=data.frame(1:n,test1,test2)
n=120
p=c()
for (k in 1:1000)
{
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+2,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
p[k] = summary(lmk)$coefficients[3,4]
}
p<.05
mean(p<.05)
n=120
p=c()
for (k in 1:1000)
{
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+5,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
p[k] = summary(lmk)$coefficients[3,4]
}
mean(p<.05)
n=120
p=c()
for (k in 1:1000)
{
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+4,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
p[k] = summary(lmk)$coefficients[3,4]
}
mean(p<.05)
n=120
p=c()
for (k in 1:1000)
{
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+3,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
p[k] = summary(lmk)$coefficients[3,4]
}
mean(p<.05)
n=120
p=c()
for (k in 1:1000)
{
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+3,dfk$test2)
lmk=lm(test2_new~test1+cond,data=dfk)
p[k] = summary(lmk)$coefficients[3,4]
}
mean(p<.05)
n=120
p1=p2=c()
for (k in 1:1000)
{
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+3,dfk$test2)
lm1=lm(test2_new~cond+test1,data=dfk)
lm2=lm(test2_new~cond,data=dfk)
p1[k] = summary(lm1)$coefficients[2,4]
p2[k] = summary(lm2)$coefficients[2,4]
}
mean(p1<.05)
mean(p2<.05)
set.seed(123)
n=606
ability=rnorm(n,50,10)
test1=round(ability+rnorm(n,0,7),0)
test2=round(ability+rnorm(n,0,7),0)
cor(test1,test2)
df=data.frame(1:n,test1,test2)
library('groundhog')
pkgs=c('this.dir')
date='2024-02-01'
groundhog.library(pkgs,date)
library('groundhog')
set.seed(123)
n=606
ability=rnorm(n,50,10)
test1=round(ability+rnorm(n,0,7),0)
test2=round(ability+rnorm(n,0,7),0)
cor(test1,test2)
write.csv(file.path(this.dir(),'students.csv')
)
library('groundhog')
pkgs=c('this.path')
date='2024-02-01'
groundhog.library(pkgs,date)
set.seed(123)
n=606
ability=rnorm(n,50,10)
test1=round(ability+rnorm(n,0,7),0)
test2=round(ability+rnorm(n,0,7),0)
cor(test1,test2)
df=data.frame(1:n,test1,test2)
write.csv(file.path(this.dir(),'students.csv'))
write.csv(df,file.path(this.dir(),'students.csv'))
write.csv(df,file.path(this.dir(),'students.csv'),row.names = FALSE)
df=data.frame(1:n,test1,test2)
write.csv(df,file.path(this.dir(),'students.csv'),row.names = FALSE)
df=data.frame(ID=1000+1:n,test1,test2)
df
write.csv(df,file.path(this.dir(),'students.csv'),row.names = FALSE)
n=250
p1=p2=c()
points=4
for (k in 1:1000)
{
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+points,dfk$test2)
lm1=lm(test2_new~cond+test1,data=dfk)
lm2=lm(test2_new~cond,data=dfk)
p1[k] = summary(lm1)$coefficients[2,4]
p2[k] = summary(lm2)$coefficients[2,4]
}
mean(p1<.05)
mean(p2<.05)
set.seed(123)
n=606
ability=rnorm(n,50,10)
test1=round(ability+rnorm(n,0,10),0)
test2=round(ability+rnorm(n,0,10),0)
cor(test1,test2)
n=250
p1=p2=c()
points=4
for (k in 1:1000)
{
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+points,dfk$test2)
lm1=lm(test2_new~cond+test1,data=dfk)
lm2=lm(test2_new~cond,data=dfk)
p1[k] = summary(lm1)$coefficients[2,4]
p2[k] = summary(lm2)$coefficients[2,4]
}
mean(p1<.05)
mean(p2<.05)
set.seed(123)
n=606
ability=rnorm(n,50,10)
test1=round(ability+rnorm(n,0,10),0)
test2=round(ability+rnorm(n,0,10),0)
cor(test1,test2)
df=data.frame(ID=1000+1:n,test1,test2)
write.csv(df,file.path(this.dir(),'students.csv'),row.names = FALSE)
set.seed(123)
n=606
ability=rnorm(n,50,10)
test1=round(ability+rnorm(n,0,10),0)
test2=round(ability+rnorm(n,0,10),0)
df=data.frame(ID=1000+1:n,test1,test2)
library('groundhog')
pkgs=c('this.path')
date='2024-02-01'
groundhog.library(pkgs,date)
set.seed(123)
n=606
ability=rnorm(n,50,10)
test1=round(ability+rnorm(n,0,10),0)
test2=round(ability+rnorm(n,0,10),0)
cor(test1,test2)
df=data.frame(ID=1000+1:n,test1,test2)
n=250
p1=p2=c()
points=4
for (k in 1:1000)
{
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+points,dfk$test2)
lm1=lm(test2_new~cond+test1,data=dfk)
lm2=lm(test2_new~cond,data=dfk)
p1[k] = summary(lm1)$coefficients[2,4]
p2[k] = summary(lm2)$coefficients[2,4]
}
mean(p1<.05)
mean(p2<.05)
set.seed(123)
n=606
ability=rnorm(n,60,25)
test1=round(ability+rnorm(n,0,10),0)
test2=round(ability+rnorm(n,0,10),0)
cor(test1,test2)
set.seed(123)
n=606
ability=rnorm(n,60,25)
test1=round(ability+rnorm(n,0,13),0)
test2=round(ability+rnorm(n,0,13),0)
cor(test1,test2)
df=data.frame(ID=1000+1:n,test1,test2)
n=250
p1=p2=c()
points=4
for (k in 1:1000)
{
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+points,dfk$test2)
lm1=lm(test2_new~cond+test1,data=dfk)
lm2=lm(test2_new~cond,data=dfk)
p1[k] = summary(lm1)$coefficients[2,4]
p2[k] = summary(lm2)$coefficients[2,4]
}
mean(p1<.05)
mean(p2<.05)
points=5
for (k in 1:1000)
{
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+points,dfk$test2)
lm1=lm(test2_new~cond+test1,data=dfk)
lm2=lm(test2_new~cond,data=dfk)
p1[k] = summary(lm1)$coefficients[2,4]
p2[k] = summary(lm2)$coefficients[2,4]
}
mean(p1<.05)
mean(p2<.05)
df=data.frame(ID=1000+1:n,test1,test2)
library('groundhog')
pkgs=c('this.path')
date='2024-02-01'
groundhog.library(pkgs,date)
set.seed(123)
n=606
ability=rnorm(n,60,25)
test1=round(ability+rnorm(n,0,13),0)
test2=round(ability+rnorm(n,0,13),0)
cor(test1,test2)
df=data.frame(ID=1000+1:n,test1,test2)
write.csv(df,file.path(this.dir(),'students.csv'),row.names = FALSE)
n=250
p1=p2=c()
points=5
for (k in 1:1000)
{
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+points,dfk$test2)
lm1=lm(test2_new~cond+test1,data=dfk)
lm2=lm(test2_new~cond,data=dfk)
p1[k] = summary(lm1)$coefficients[2,4]
p2[k] = summary(lm2)$coefficients[2,4]
}
mean(p1<.05)
mean(p2<.05)
n=250
p1=p2=c()
points=5
for (k in 1:5000)
{
sub=sample(nrow(df),size=2*n,replace=TRUE)
dfk=df[sub,]
dfk$cond=rep(c("A","B"), n)
dfk$test2_new=ifelse(dfk$cond=="A",dfk$test2+points,dfk$test2)
lm1=lm(test2_new~cond+test1,data=dfk)
lm2=lm(test2_new~cond,data=dfk)
p1[k] = summary(lm1)$coefficients[2,4]
p2[k] = summary(lm2)$coefficients[2,4]
}
mean(p1<.05)
mean(p2<.05)
#1. Clear
rm(list = ls())
#2 Load the data
library('this.path')
path <- file.path( this.dir() , 'proficiency exams.rds')
df  <- readRDS(path)
#3 Describe
head(df)
hist(df$score)
plot(table(df$score))
#4 Let's see what happens if we run A/B tests with sample szie a la pocock
N=600
scores=df$score
p1=p2=p3=c()
simtot=10000
for (simk in 1:simtot)
{
A1 = sample(scores,size=N/3,replace=TRUE)
B1 = sample(scores,size=N/3,replace=TRUE)
p1[simk]=t.test(A1,B1)$p.value
A2 = c(A1, sample(scores,size=N/3,replace=TRUE))
B2 = c(B1, sample(scores,size=N/3,replace=TRUE))
p2[simk]=t.test(A2,B2)$p.value
A3 = c(A2 , sample(scores,size=N/3,replace=TRUE))
B3 = c(B2 , sample(scores,size=N/3,replace=TRUE))
p3[simk]=t.test(A1,B2)$p.value
if (simk%%1000==0) cat('...',simk)
}
mean(p1<.05)
mean(p2<.05)
mean(p3<.05)
mean(p1<.0223 | p2<.0223 | p3<.0223)  #this is the FPR for stopping when p<.0223 and checking three times
N=1800
scores=df$score
p1=p2=p3=c()
simtot=10000
for (simk in 1:simtot)
{
A1 = sample(scores,size=N/3,replace=TRUE)
B1 = sample(scores,size=N/3,replace=TRUE)
p1[simk]=t.test(A1,B1)$p.value
A2 = c(A1, sample(scores,size=N/3,replace=TRUE))
B2 = c(B1, sample(scores,size=N/3,replace=TRUE))
p2[simk]=t.test(A2,B2)$p.value
A3 = c(A2 , sample(scores,size=N/3,replace=TRUE))
B3 = c(B2 , sample(scores,size=N/3,replace=TRUE))
p3[simk]=t.test(A1,B2)$p.value
if (simk%%1000==0) cat('...',simk)
}
mean(p1<.05)
mean(p2<.05)
mean(p3<.05)
mean(p1<.0223 | p2<.0223 | p3<.0223)  #this is the FPR for stopping when p<.0223 and checking three times
